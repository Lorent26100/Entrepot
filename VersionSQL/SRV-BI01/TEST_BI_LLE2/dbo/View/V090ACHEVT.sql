/****** Object:  View [dbo].[V090ACHEVT]    Committed by VersionSQL https://www.versionsql.com ******/

CREATE VIEW [dbo].[V090ACHEVT] (
F090KY,  F090HT,  F090TVA,  F090TT,
F090DEVHT, F090DEVTVA, F090DEVTT
) AS
select K410090UNI as F090KY, sum(MTHT) as F090HT, sum(TVAMT) as F090TVA, sum(MTTT) as F090TT,
sum(DEVHT) as F090DEVHT, sum(DEVTVA) as F090DEVTVA, sum(DEVTT) as F090DEVTT from 
(
SELECT K410090UNI, SUM(F410MTHT) as MTHT, SUM(F410TVAMT) as TVAMT,SUM(F410MTTT) as MTTT,
sum(F410DEVHT) as DEVHT, sum(F410DEVTVA) as DEVTVA, sum(F410DEVTT) as DEVTT
from F410LIG  LIG, F400EVT  EVT, F100PRO  PRO
where (K410090UNI <> '' or K410090UNI is not null)
and F100VEHACHVEN='1'
and K410100PRO=F100KY
and K400305TYP ='2'
and K400T43TYP = '1'
and K400T63STATU='3'
and K410400EVT=F400KY
GROUP BY K410090UNI
union
SELECT K410090UNI, SUM(F410MTHT * -1) as MTHT, SUM(F410TVAMT * -1) as TVAMT ,SUM(F410MTTT * -1) as MTTT,
sum(F410DEVHT * -1) as DEVHT, sum(F410DEVTVA * -1) as DEVTVA, sum(F410DEVTT * -1) as DEVTT
from F410LIG LIG, F400EVT EVT, F100PRO PRO
where (K410090UNI <> '' or K410090UNI is not null)
and F100VEHACHVEN='1'
and K410100PRO=F100KY
and K400305TYP ='1'
and K400T43TYP = '1'
and K400T63STATU='3'
and K410400EVT=F400KY
and K400T44TYP = 'PV'
GROUP BY K410090UNI
) V090ACHEVT
group by K410090UNI
