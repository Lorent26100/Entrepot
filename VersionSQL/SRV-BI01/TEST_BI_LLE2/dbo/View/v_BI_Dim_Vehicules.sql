/****** Object:  View [dbo].[v_BI_Dim_Vehicules]    Committed by VersionSQL https://www.versionsql.com ******/

CREATE VIEW v_BI_Dim_Vehicules AS SELECT
		F090PARC.F090KY AS Code, 
		F090PARC.K090001SOC AS societe, 
		F090PARC.K090030AGE AS Agence, 
		F090PARC.K090060MOD AS Modele, 
		F061MODINF.K061T25CAT AS Categorie, 
		VT25CAT.F901MSG AS Libelle_categorie, 
		VT25CAT.FT25ORDRE AS Ordre_Categorie, 
		F090PARC.F090SERIE AS N_de_serie, 
		F090PARC.F090DTMISC AS Date_mise_en_circulation, 
		F090PARC.F090INDT AS Date_entree, 
		F090PARC.F090OUTDTP AS Date_sortie_prevue, 
		F090PARC.F090OUTDT AS Date_sortie, 
		F090PARC.F090MOISDET AS Duree_detention, 
		F091IMMAT.F091IMMA AS Immatriculation, 
		F570MVT.K570030ARR AS Situation_agence, 
		F570MVT.K570050CLT AS Situation_client, 
		F050TIERS.F050NOM  AS Situation_client_nom, 
		CASE WHEN (V090ACHEVT.F090HT IS NULL) THEN F090PARC.F090ACHPXHT ELSE V090ACHEVT.F090HT + F090PARC.F090ACHPXHT END AS Montant_achat, 
		F090PARC.F090ACHFACDT AS Date_achat, 
		F090PARC.F090VENPXHT AS Montant_vente, 
		F090PARC.F090VENFACDT AS Date_vente, 
		F090PARC.F090KM AS Cumul_kilometrique, 
		F090PARC.K090050FOU AS Fournisseur, 
		F090PARC.K090306ANA AS Analytique, 
		VT07TYP.FT07KY AS Code_type_materiel, 
		VT07TYP.F901MSG AS Libelle_type_materiel, 
		VT27POO.FT27KY AS Code_pool_non_pool, 
		VT27POO.F901MSG AS Libelle_pool_non_pool, 
		VT26ACR.FT26KY AS Code_ACRISS, 
		VT26ACR.F901MSG AS Libelle_ACRISS, 
		VT70ACHTYP.FT70KY AS Code_type_achat, 
		VT70ACHTYP.F901MSG AS Libelle_type_achat, 
		VTE8FAMILLE.FTE8KY AS Code_famille_comptable, 
		VTE8FAMILLE.F901MSG AS Libelle_famille_comptable, 
		F090PARC.K090T07TYP AS Type_de_materiel, 
		VT58POS_F090.FT58KY AS code_position_parc,
		VT58POS_F090.F901MSG AS Libelle_position_parc, 
		VT58POS_F570.FT58KY AS Code_position_dernier_mouvement, 
		VT58POS_F570.F901MSG AS Libelle_position_dernier_mouvement, 
		F570MVT.F570DTDEP AS Date_depart_dernier_mouvement, 
		F570MVT.F570DTARR AS Date_arrivee_dernier_mouvement
	FROM
		 dbo.F090PARC AS F090PARC 
		 INNER JOIN  dbo.F061MODINF AS F061MODINF ON(  F061MODINF.F061KY = F090PARC.K090061MOD )
		 LEFT OUTER JOIN  dbo.F091IMMAT AS F091IMMAT ON(  F091IMMAT.F091KY = F090PARC.K090091IMM )
		 INNER JOIN  dbo.VT25CAT AS VT25CAT ON(  VT25CAT.FT25KY = F061MODINF.K061T25CAT )
		 LEFT OUTER JOIN  dbo.F570MVT AS F570MVT ON(  F570MVT.F570KY = F090PARC.L090570DERMVT )
		 LEFT OUTER JOIN  dbo.F050TIERS AS F050TIERS ON(  F050TIERS.F050KY = F570MVT.K570050CLT )
		 LEFT OUTER JOIN  dbo.V090ACHEVT AS V090ACHEVT ON(  V090ACHEVT.F090KY = F090PARC.F090KY )
		 LEFT OUTER JOIN  dbo.VT07TYP AS VT07TYP ON(  VT07TYP.FT07KY = F090PARC.K090T07TYP )
		 LEFT OUTER JOIN  dbo.VT27POO AS VT27POO ON(  VT27POO.FT27KY = F090PARC.K090T27POO )
		 LEFT OUTER JOIN  dbo.VT26ACR AS VT26ACR ON(  VT26ACR.FT26KY = F061MODINF.K061T26ACR )
		 LEFT OUTER JOIN  dbo.VT70ACHTYP AS VT70ACHTYP ON(  VT70ACHTYP.FT70KY = F090PARC.K090T70ACHTYP )
		 LEFT OUTER JOIN  dbo.VTE8FAMILLE AS VTE8FAMILLE ON(  VTE8FAMILLE.FTE8KY = F061MODINF.K061TE8FAMCPTA )
		 LEFT OUTER JOIN  dbo.VT58POS as VT58POS_F090 ON(  VT58POS_F090.FT58KY = F090PARC.K090T58POS )
		 LEFT OUTER JOIN  dbo.VT58POS as VT58POS_F570 ON(  VT58POS_F570.FT58KY = F570MVT.K570T58POS )
